# Project settings
project = "The-Web-for-Audit"

[services]

# ---------------------------
# Web service (Flask + Gunicorn)
# ---------------------------
[services.web]
  build = "."
  run = "sh -c 'gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 300'"
  env = [
    { key = "PYTHONUNBUFFERED", value = "1" },
    { key = "FLASK_ENV", value = "production" },
    { key = "PORT", value = "8080" }
  ]
  ports = [
    { port = 8080, protocol = "tcp" }
  ]

# ---------------------------
# Worker service (RQ)
# ---------------------------
[services.worker]
  build = "."
  run = "sh -c 'rq worker $RQ_QUEUE'"
  env = [
    { key = "PYTHONUNBUFFERED", value = "1" },
    { key = "RQ_QUEUE", value = "default" }
  ]

# ---------------------------
# Scheduler service (RQ)
# ---------------------------
[services.scheduler]
  build = "."
  run = "sh -c 'python scheduler.py'"
  env = [
    { key = "PYTHONUNBUFFERED", value = "1" }
  ]
